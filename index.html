<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jasper æ•¸å­¸ç‰¹è¨“ P3 - æ¨¡æ“¬è©¦å·</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Roboto+Mono:wght@500;700&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f8fafc;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        button:active { transform: scale(0.95); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* ç›´å¼é‹ç®—å°ˆç”¨æ ¼ç·š */
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
            font-family: 'Roboto Mono', monospace;
            font-size: 2rem;
            line-height: 1.2;
            text-align: center;
            font-weight: 700;
            color: #334155;
        }
        .calc-line {
            grid-column: 1 / -1;
            height: 4px;
            background-color: #334155;
            margin-top: 4px;
            margin-bottom: 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- SVG Icons ---
        const Icon = {
            Brain: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Calc: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Check: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
            Clock: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ArrowRight: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        };

        // --- é¡Œç›®é¡å‹å®šç¾© (å°ä¸‰ P3) ---
        const QUESTION_TYPES = {
            MIXED_OP: 'æ··åˆè¨ˆç®—',        // æ‹¬è™Ÿã€åŠ æ¸›ä¹˜æ··åˆ
            VERTICAL_4D: 'å››ä½æ•¸ç›´å¼',   // 4ä½æ•¸é€£çºŒåŠ æ¸›
            TIME_24H: '24å°æ™‚åˆ¶',       // 12è½‰24ï¼Œæ™‚é–“æ¨ç®—
            WORD_PROB: 'æ–‡å­—æ‡‰ç”¨é¡Œ'      // å€æ•¸ã€æ¯”è¼ƒã€æ‰¾è´–
        };

        // --- å­çµ„ä»¶ï¼šç›´å¼æ’ç‰ˆ (å‡ç´šç‰ˆï¼šå°é½Š Grid) ---
        // æ¨¡æ“¬ CSV/ç›´å¼ç°¿æ ¼å¼ï¼Œå¼·åˆ¶å°é½Š
        const VerticalMath = ({ numbers, operators, result, showResult = false }) => {
            // å°‡æ•¸å­—è½‰æ›ç‚ºå­—ä¸²ä¸¦è£œé›¶ä»¥å°é½Šï¼Œä½†åœ¨é¡¯ç¤ºæ™‚éš±è—å‰å°ç©ºæ ¼
            const formatNum = (n) => n.toString().padStart(5, ' ');
            
            return (
                <div className="bg-white p-6 rounded-xl border-2 border-slate-200 shadow-inner w-fit mx-auto my-6">
                    <div className="calc-grid">
                        {/* ç¬¬ä¸€å€‹æ•¸ */}
                        <div className="col-span-5 text-right tracking-[0.5em]">{numbers[0]}</div>
                        
                        {/* å¾ŒçºŒæ•¸å­—èˆ‡ç¬¦è™Ÿ */}
                        {numbers.slice(1).map((num, idx) => (
                            <React.Fragment key={idx}>
                                <div className="col-span-1 text-left font-black text-slate-400">{operators[idx]}</div>
                                <div className="col-span-4 text-right tracking-[0.5em]">{num}</div>
                            </React.Fragment>
                        ))}
                        
                        {/* æ©«ç·š */}
                        <div className="calc-line"></div>
                        
                        {/* ç­”æ¡ˆå€åŸŸ */}
                        <div className="col-span-5 text-right tracking-[0.5em] text-indigo-600 font-black h-12">
                            {showResult ? result : '?????'}
                        </div>
                    </div>
                </div>
            );
        };

        // --- å­çµ„ä»¶ï¼šæ™‚é˜ ---
        const ClockFace = ({ h, m, size = 200 }) => {
            const hourAngle = (h * 30) + (m * 0.5);
            const minuteAngle = m * 6;
            return (
                <div className="relative flex justify-center items-center my-4">
                    <svg width={size} height={size} viewBox="0 0 200 200" className="drop-shadow-xl">
                        <circle cx="100" cy="100" r="95" fill="white" stroke="#334155" strokeWidth="6" />
                        {[...Array(12)].map((_, i) => (
                            <text key={i} x={100 + 75 * Math.sin((i+1)*Math.PI/6)} y={105 - 75 * Math.cos((i+1)*Math.PI/6)} 
                                textAnchor="middle" className="font-bold text-lg font-mono" fill="#64748b">{i+1}</text>
                        ))}
                        {/* æ™‚é‡ */}
                        <line x1="100" y1="100" x2={100 + 50 * Math.sin(hourAngle * Math.PI / 180)} y2={100 - 50 * Math.cos(hourAngle * Math.PI / 180)} stroke="#1e293b" strokeWidth="6" strokeLinecap="round" />
                        {/* åˆ†é‡ */}
                        <line x1="100" y1="100" x2={100 + 75 * Math.sin(minuteAngle * Math.PI / 180)} y2={100 - 75 * Math.cos(minuteAngle * Math.PI / 180)} stroke="#ef4444" strokeWidth="4" strokeLinecap="round" />
                        <circle cx="100" cy="100" r="5" fill="#1e293b" />
                    </svg>
                </div>
            );
        };

        const App = () => {
            const [step, setStep] = useState('intro'); // intro, quiz, result
            const [qIndex, setQIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [history, setHistory] = useState([]);
            const [currentQ, setCurrentQ] = useState(null);
            
            // ç­”é¡Œç‹€æ…‹
            const [subStep, setSubStep] = useState('step1'); // step1 (logic/equation), step2 (calc)
            const [selectedOpt, setSelectedOpt] = useState(null);
            const [isCorrect, setIsCorrect] = useState(null);
            const [showExplanation, setShowExplanation] = useState(false);
            
            // æ™‚é˜äº’å‹•ç‹€æ…‹
            const [clockH, setClockH] = useState(12);
            const [clockM, setClockM] = useState(0);

            // ç¸½é¡Œæ•¸
            const TOTAL_QUESTIONS = 10; 

            // --- é¡Œç›®ç”Ÿæˆé‚è¼¯ (P3 æ ¸å¿ƒ) ---
            const generateQuestion = () => {
                const types = Object.values(QUESTION_TYPES);
                // è¼ªæµå‡ºé¡Œï¼Œç¢ºä¿è¦†è“‹æ‰€æœ‰é¡å‹
                const type = types[qIndex % types.length]; 
                
                let q = { type, id: Date.now() };

                // é‡ç½®äº’å‹•æ™‚é˜
                setClockH(8); setClockM(0);

                if (type === QUESTION_TYPES.MIXED_OP) {
                    // P3 æ··åˆè¨ˆç®—ï¼šå¸¶æ‹¬è™Ÿ
                    // 1. 30 - (12 + 8)
                    // 2. (20 - 5) * 4
                    const pattern = Math.random() > 0.5 ? 'SUB_BRACKET_ADD' : 'BRACKET_SUB_MULT';
                    
                    if (pattern === 'SUB_BRACKET_ADD') {
                        const a = Math.floor(Math.random() * 20) + 30; // 30-50
                        const b = Math.floor(Math.random() * 10) + 5;
                        const c = Math.floor(Math.random() * 10) + 1;
                        q.text = `è¨ˆç®—ï¼š${a} - (${b} + ${c}) = ?`;
                        q.formula = `${a} - (${b} + ${c})`;
                        q.step1Q = "ç¬¬ä¸€æ­¥æ‡‰è©²å…ˆç®—ç”šéº¼ï¼Ÿ";
                        q.step1Opts = shuffle([`${b} + ${c}`, `${a} - ${b}`, `${a} + ${c}`]);
                        q.step1Ans = `${b} + ${c}`;
                        q.step2Ans = a - (b + c);
                        q.explanation = `è¨˜å¾—ã€Œå…ˆç®—æ‹¬å¼§å…§ã€ï¼ ${b}+${c}=${b+c}ï¼Œç„¶å¾Œ ${a}-${b+c}=${q.step2Ans}ã€‚`;
                        q.hint = "æœ‰æ‹¬å¼§è¦å…ˆç®—æ‹¬å¼§è£é¢çš„æ•¸ã€‚";
                    } else {
                        const a = Math.floor(Math.random() * 10) + 10;
                        const b = Math.floor(Math.random() * 5) + 1;
                        const c = Math.floor(Math.random() * 4) + 2; // mult by 2-5
                        q.text = `è¨ˆç®—ï¼š(${a} - ${b}) Ã— ${c} = ?`;
                        q.formula = `(${a} - ${b}) Ã— ${c}`;
                        q.step1Q = "é€™é¡Œè¦å…ˆè¨ˆç®—å“ªéƒ¨åˆ†ï¼Ÿ";
                        q.step1Opts = shuffle([`${a} - ${b}`, `${b} Ã— ${c}`, `${a} Ã— ${c}`]);
                        q.step1Ans = `${a} - ${b}`;
                        q.step2Ans = (a - b) * c;
                        q.explanation = `æ‹¬å¼§æœ€å¤§ï¼å…ˆç®— ${a}-${b}=${a-b}ï¼Œå†ç®— ${a-b}Ã—${c}=${q.step2Ans}ã€‚`;
                        q.hint = "æ‹¬å¼§è£é¢çš„æ¸›æ³•è¦å„ªå…ˆè¨ˆç®—ã€‚";
                    }

                } else if (type === QUESTION_TYPES.VERTICAL_4D) {
                    // P3 å››ä½æ•¸ç›´å¼ (åŒ…å«é€£çºŒé‹ç®—)
                    const isMixed = Math.random() > 0.5;
                    const n1 = Math.floor(Math.random() * 2000) + 1000;
                    const n2 = Math.floor(Math.random() * 2000) + 500;
                    const n3 = Math.floor(Math.random() * 500) + 100;
                    
                    q.operators = ['+', isMixed ? '-' : '+'];
                    q.numbers = [n1, n2, n3];
                    q.step2Ans = isMixed ? n1 + n2 - n3 : n1 + n2 + n3;
                    
                    q.text = "è«‹ç”¨ç›´å¼è¨ˆç®—ä¸‹åˆ—ç®—å¼ï¼š";
                    q.formula = `${n1} + ${n2} ${q.operators[1]} ${n3}`;
                    q.step1Q = "é€™é¡Œçš„ç›´å¼è¨ˆç®—æŠ€å·§æ˜¯ï¼Ÿ";
                    q.step1Opts = ["å€‹ä½å°å€‹ä½ï¼Œåä½å°åä½", "å…¨éƒ¨é å·¦å°é½Š", "éš¨ä¾¿å¯«éƒ½å¯ä»¥"];
                    q.step1Ans = "å€‹ä½å°å€‹ä½ï¼Œåä½å°åä½";
                    q.explanation = "ä½å€¼å°é½Šå¾ˆé‡è¦ï¼è¨ˆç®—æ™‚è¦å°å¿ƒé€²ä½å’Œé€€ä½ã€‚";
                    q.hint = "è«‹åœ¨ç´™ä¸Šå¯«å‡ºç›´å¼ï¼Œå°é½Šæ•¸å­—å†è¨ˆç®—ã€‚";

                } else if (type === QUESTION_TYPES.TIME_24H) {
                    // 24å°æ™‚åˆ¶è½‰æ›
                    const isPM = true; 
                    const h = Math.floor(Math.random() * 11) + 1; // 1-11
                    const m = [0, 15, 30, 45][Math.floor(Math.random() * 4)];
                    
                    q.displayTime = { h, m };
                    q.isPM = isPM;
                    q.text = `åœ–ä¸­æ™‚é˜é¡¯ç¤ºçš„æ™‚é–“æ˜¯ ä¸‹åˆ ${h}:${m === 0 ? '00' : m}ã€‚`;
                    q.subText = "è«‹ç”¨ã€Œ24å°æ™‚å ±æ™‚åˆ¶ã€è¡¨ç¤ºã€‚";
                    
                    q.step1Q = "ä¸‹åˆçš„æ™‚é–“è½‰æ›æˆ24å°æ™‚åˆ¶ï¼Œå°æ™‚è¦ï¼Ÿ";
                    q.step1Opts = ["åŠ  12", "æ¸› 12", "ä¸è®Š"];
                    q.step1Ans = "åŠ  12";
                    
                    const ansH = h + 12;
                    q.step2Ans = `${ansH}:${m === 0 ? '00' : m}`;
                    // å¢åŠ å¹²æ“¾é …
                    q.step2Options = shuffle([
                        `${ansH}:${m === 0 ? '00' : m}`, 
                        `${h}:${m === 0 ? '00' : m}`, 
                        `${ansH-2}:${m === 0 ? '00' : m}`,
                        `${h+10}:${m === 0 ? '00' : m}`
                    ]);
                    
                    q.explanation = `ä¸‹åˆæ™‚é–“éœ€è¦åŠ  12 å°æ™‚ã€‚${h} + 12 = ${ansH}ã€‚æ‰€ä»¥æ˜¯ ${q.step2Ans}ã€‚`;
                    q.hint = "ä¸‹åˆæ™‚é–“ = ä¸Šåˆæ™‚é–“ + 12ã€‚";

                } else if (type === QUESTION_TYPES.WORD_PROB) {
                    // æ–‡å­—é¡Œï¼šå€æ•¸ æˆ– æ‰¾è´–
                    const scenario = Math.random() > 0.5 ? 'SHOPPING' : 'STAMPS';
                    
                    if (scenario === 'SHOPPING') {
                        const total = 100; // æ“æœ‰ 100 å…ƒ
                        const price = Math.floor(Math.random() * 10) + 15; // 15-24 å…ƒ
                        const count = 4;
                        const cost = price * count;
                        q.text = `Jasper æœ‰ ${total} å…ƒï¼Œæƒ³è²· ${count} å€‹éµç”²äººï¼Œæ¯å€‹ ${price} å…ƒã€‚é‚„æ¬ å¤šå°‘å…ƒï¼Ÿ(è‹¥å¤ éŒ¢å‰‡å¡« 0)`;
                        // ä¿®æ­£é¡Œç›®é‚è¼¯ï¼šç¢ºä¿æ˜¯ã€Œé‚„æ¬ ã€æˆ–ã€Œæ‰¾å›ã€
                        // é€™è£¡è¨­å®šç‚ºç·´ç¿’ã€Œä¹˜æ³•å¾Œæ¸›æ³•ã€
                        // å‡è¨­å•é¡Œæ˜¯ï¼šè²·äº†ä¹‹å¾Œå‰©å¤šå°‘ï¼Ÿæˆ–è€…å¤ ä¸å¤ ï¼Ÿ
                        // è®“æˆ‘å€‘è·Ÿéš¨ä½ çš„ç¯„ä¾‹ï¼š50å…ƒè²·3å€‹19å…ƒï¼Œæ¬ å¤šå°‘ã€‚
                        
                        const myMoney = 50;
                        const itemPrice = 19;
                        const buyCount = 3;
                        const totalCost = itemPrice * buyCount;
                        const diff = totalCost - myMoney; // 57 - 50 = 7
                        
                        q.text = `æˆ‘æœ‰ ${myMoney} å…ƒï¼Œæƒ³è²· ${buyCount} å€‹éµç”²äººï¼Œæ¯å€‹ ${itemPrice} å…ƒï¼Œé‚„æ¬ å¤šå°‘å…ƒï¼Ÿ`;
                        q.step1Q = "é€™é¡Œè¦å…ˆç®—ç”šéº¼ï¼Ÿ";
                        q.step1Opts = [`å…ˆç®— ${buyCount} å€‹éµç”²äººç¸½å…±å¤šå°‘éŒ¢`, `å…ˆç®— ${myMoney} æ¸› ${itemPrice}`];
                        q.step1Ans = `å…ˆç®— ${buyCount} å€‹éµç”²äººç¸½å…±å¤šå°‘éŒ¢`;
                        q.step2Ans = diff;
                        q.explanation = `ç¸½å…±éœ€ä»˜ï¼š${itemPrice} Ã— ${buyCount} = ${totalCost}å…ƒã€‚å› ç‚º ${totalCost} > ${myMoney}ï¼Œæ‰€ä»¥é‚„æ¬  ${totalCost - myMoney} å…ƒã€‚`;
                        q.hint = "å…ˆä¹˜å¾Œæ¸›ï¼šç¸½åƒ¹ - æ“æœ‰çš„éŒ¢ = æ¬ çš„éŒ¢ã€‚";
                        
                    } else {
                        // å€æ•¸é¡Œ
                        // å¼Ÿå¼Ÿæœ‰ 20ï¼Œå“¥å“¥æ˜¯å¼Ÿå¼Ÿ 4 å€ï¼Œæ±‚ç¸½å’Œ
                        const base = Math.floor(Math.random() * 10) + 15;
                        const mult = 4;
                        q.text = `å¼Ÿå¼Ÿæœ‰ ${base} æšéƒµç¥¨ï¼Œå“¥å“¥çš„æ•¸é‡æ˜¯å¼Ÿå¼Ÿçš„ ${mult} å€ã€‚ä»–å€‘ã€Œå…±æœ‰ã€å¤šå°‘æšï¼Ÿ`;
                        q.step1Q = "è¦è¨ˆç®—ã€Œå…±æœ‰ã€ï¼Œç®—å¼æ˜¯ï¼Ÿ";
                        q.step1Opts = [`${base} + ${base} Ã— ${mult}`, `${base} Ã— ${mult}`, `(${base} + ${base}) Ã— ${mult}`];
                        q.step1Ans = `${base} + ${base} Ã— ${mult}`;
                        q.step2Ans = base + (base * mult);
                        q.explanation = `å“¥å“¥æœ‰ ${base}Ã—${mult}=${base*mult}ã€‚å…±æœ‰ï¼šå¼Ÿå¼Ÿ(${base}) + å“¥å“¥(${base*mult}) = ${q.step2Ans}ã€‚`;
                        q.hint = "å…±æœ‰ = å¼Ÿå¼Ÿçš„ + å“¥å“¥çš„ã€‚";
                    }
                }

                return q;
            };

            const shuffle = (array) => [...array].sort(() => Math.random() - 0.5);

            const startQuiz = () => {
                setScore(0);
                setHistory([]);
                setQIndex(0);
                setCurrentQ(generateQuestion());
                setStep('quiz');
                setSubStep('step1');
                setShowExplanation(false);
            };

            const handleOptionClick = (opt) => {
                if (showExplanation) return;
                
                if (subStep === 'step1') {
                    if (opt === currentQ.step1Ans) {
                        setSubStep('step2');
                    } else {
                        // ç¬¬ä¸€æ­¥éŒ¯ï¼Œç›´æ¥åˆ¤éŒ¯ä¸¦é¡¯ç¤ºè§£é‡‹
                        setIsCorrect(false);
                        setSelectedOpt(opt);
                        setShowExplanation(true);
                        // è¨˜éŒ„éŒ¯èª¤
                        setHistory([...history, { ...currentQ, userAns: opt, correct: false, stage: 'Logic' }]);
                    }
                } else {
                    // Step 2 Answer check
                    // å°æ–¼ Time 24H é¡Œå‹ï¼Œopt æ˜¯å­—ä¸²ã€‚å°æ–¼å…¶ä»–è¨ˆç®—é¡Œï¼Œopt å¯èƒ½æ˜¯è¼¸å…¥æ¡†çš„å€¼
                    const isRight = opt.toString() === currentQ.step2Ans.toString();
                    setIsCorrect(isRight);
                    setSelectedOpt(opt);
                    setShowExplanation(true);
                    if (isRight) setScore(s => s + 1);
                    setHistory([...history, { ...currentQ, userAns: opt, correct: isRight, stage: 'Calc' }]);
                }
            };

            const handleInputSubmit = (val) => {
                if (showExplanation) return;
                const numVal = parseInt(val);
                const isRight = numVal === parseInt(currentQ.step2Ans);
                setIsCorrect(isRight);
                setSelectedOpt(val);
                setShowExplanation(true);
                if (isRight) setScore(s => s + 1);
                setHistory([...history, { ...currentQ, userAns: val, correct: isRight, stage: 'Calc' }]);
            };

            const nextQ = () => {
                if (qIndex >= TOTAL_QUESTIONS - 1) {
                    setStep('result');
                } else {
                    setQIndex(q => q + 1);
                    setCurrentQ(generateQuestion());
                    setSubStep('step1');
                    setIsCorrect(null);
                    setShowExplanation(false);
                    setSelectedOpt(null);
                }
            };

            // --- æ¸²æŸ“éƒ¨åˆ† ---

            if (step === 'intro') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-slate-50">
                        <div className="max-w-md w-full bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-200">
                            <div className="bg-indigo-600 p-8 text-center">
                                <div className="inline-block p-4 bg-white/20 rounded-full mb-4">
                                    <Icon.Brain />
                                </div>
                                <h1 className="text-3xl font-black text-white mb-2">Jasper æ•¸å­¸ç‰¹è¨“</h1>
                                <p className="text-indigo-100 font-bold">å°ä¸‰ä¸‹å­¸æœŸæ¨¡æ“¬è©¦å·</p>
                            </div>
                            <div className="p-8 space-y-6">
                                <div className="flex items-start gap-4 p-4 bg-amber-50 rounded-2xl border border-amber-100">
                                    <div className="text-amber-500 mt-1"><Icon.Check /></div>
                                    <div>
                                        <h3 className="font-bold text-slate-800">ç‰¹è¨“é‡é»ï¼šç›´å¼è¨ˆç®—</h3>
                                        <p className="text-sm text-slate-600 mt-1">é‡åˆ°è¨ˆç®—é¡Œï¼Œè«‹æ‹¿å‡ºç´™ç­†ï¼Œå¯«æˆç›´å¼å†ä½œç­”ã€‚ä¸è¦åªç”¨å¿ƒç®—å–”ï¼</p>
                                    </div>
                                </div>
                                <button onClick={startQuiz} className="w-full bg-slate-900 text-white font-black py-4 rounded-xl text-xl shadow-lg hover:bg-slate-800 active:scale-95 transition-all">
                                    é–‹å§‹æŒ‘æˆ°
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (step === 'quiz' && currentQ) {
                return (
                    <div className="min-h-screen p-4 md:p-8 max-w-2xl mx-auto">
                        {/* é€²åº¦æ¢ */}
                        <div className="flex justify-between items-center mb-6 px-2">
                            <div className="text-slate-500 font-bold">Question {qIndex + 1} / {TOTAL_QUESTIONS}</div>
                            <div className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold">{currentQ.type}</div>
                        </div>

                        <div className="bg-white rounded-[2.5rem] shadow-lg border border-slate-200 overflow-hidden relative">
                            {/* é¡Œç›®å€åŸŸ */}
                            <div className="p-8 pb-4">
                                <h2 className="text-2xl font-black text-slate-800 leading-snug mb-4">{currentQ.text}</h2>
                                {currentQ.subText && <p className="text-slate-500 font-bold">{currentQ.subText}</p>}
                                
                                {/* æ ¹æ“šé¡Œå‹é¡¯ç¤ºè¼”åŠ©åœ–å½¢ */}
                                {currentQ.type === QUESTION_TYPES.VERTICAL_4D && (
                                    <VerticalMath 
                                        numbers={currentQ.numbers} 
                                        operators={currentQ.operators} 
                                        result={currentQ.step2Ans}
                                        showResult={showExplanation}
                                    />
                                )}
                                
                                {currentQ.type === QUESTION_TYPES.TIME_24H && (
                                    <ClockFace h={currentQ.displayTime.h} m={currentQ.displayTime.m} />
                                )}
                            </div>

                            {/* ä½œç­”å€åŸŸ */}
                            <div className="bg-slate-50 p-8 border-t border-slate-100 min-h-[300px]">
                                {!showExplanation ? (
                                    <>
                                        {/* ç¬¬ä¸€æ­¥ï¼šé‚è¼¯é¸æ“‡ */}
                                        {subStep === 'step1' && (
                                            <div className="animate-in slide-in-from-right duration-300">
                                                <div className="flex items-center gap-2 mb-4 text-indigo-600 font-black text-sm uppercase tracking-widest">
                                                    <span className="w-6 h-6 rounded-full bg-indigo-600 text-white flex items-center justify-center text-xs">1</span>
                                                    {currentQ.step1Q}
                                                </div>
                                                <div className="grid gap-3">
                                                    {currentQ.step1Opts.map((opt, i) => (
                                                        <button key={i} onClick={() => handleOptionClick(opt)} className="p-4 bg-white border-2 border-slate-200 rounded-xl text-left font-bold text-slate-700 hover:border-indigo-500 hover:text-indigo-600 transition-all shadow-sm">
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                                {currentQ.type !== QUESTION_TYPES.TIME_24H && (
                                                   <div className="mt-4 p-3 bg-yellow-50 text-yellow-700 text-sm rounded-lg border border-yellow-100 flex gap-2">
                                                       <span>ğŸ’¡</span> æç¤ºï¼š{currentQ.hint}
                                                   </div>
                                                )}
                                            </div>
                                        )}

                                        {/* ç¬¬äºŒæ­¥ï¼šè¨ˆç®—ä½œç­” */}
                                        {subStep === 'step2' && (
                                            <div className="animate-in slide-in-from-right duration-300">
                                                <div className="flex items-center gap-2 mb-6 text-emerald-600 font-black text-sm uppercase tracking-widest">
                                                    <span className="w-6 h-6 rounded-full bg-emerald-600 text-white flex items-center justify-center text-xs">2</span>
                                                    {currentQ.type === QUESTION_TYPES.VERTICAL_4D ? "è«‹è¼¸å…¥ç›´å¼æœ€å¾Œç­”æ¡ˆ" : "ç¾åœ¨ï¼Œç®—å‡ºæ­£ç¢ºç­”æ¡ˆ"}
                                                </div>

                                                {/* æ ¹æ“šé¡Œå‹é¡¯ç¤ºä¸åŒçš„è¼¸å…¥æ–¹å¼ */}
                                                {currentQ.step2Options ? (
                                                    // é¸æ“‡é¡Œæ¨¡å¼ (24H æ™‚é–“)
                                                    <div className="grid grid-cols-2 gap-4">
                                                        {currentQ.step2Options.map((opt, i) => (
                                                            <button key={i} onClick={() => handleOptionClick(opt)} className="p-6 bg-white border-2 border-slate-200 rounded-2xl font-black text-xl text-slate-800 hover:border-emerald-500 transition-all shadow-sm">
                                                                {opt}
                                                            </button>
                                                        ))}
                                                    </div>
                                                ) : (
                                                    // è¼¸å…¥æ¡†æ¨¡å¼ (è¨ˆç®—é¡Œ)
                                                    <div className="flex flex-col gap-4">
                                                        <input 
                                                            type="number" 
                                                            placeholder="è¼¸å…¥ç­”æ¡ˆ..." 
                                                            className="w-full p-6 text-3xl font-black text-center rounded-2xl border-4 border-slate-200 focus:border-indigo-500 outline-none transition-all"
                                                            onKeyDown={(e) => e.key === 'Enter' && handleInputSubmit(e.target.value)}
                                                            id="ansInput"
                                                        />
                                                        <button onClick={() => handleInputSubmit(document.getElementById('ansInput').value)} className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all">
                                                            ç¢ºå®š
                                                        </button>
                                                        <p className="text-center text-xs text-slate-400 mt-2">è«‹åœ¨è‰ç¨¿ç´™ä¸Šå®Œæˆç›´å¼å¾Œå†è¼¸å…¥</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    // è§£é‡‹èˆ‡åé¥‹
                                    <div className="animate-in zoom-in-95 duration-300">
                                        <div className={`p-6 rounded-2xl border-l-8 mb-6 ${isCorrect ? 'bg-green-50 border-green-500 text-green-800' : 'bg-red-50 border-red-500 text-red-800'}`}>
                                            <h3 className="text-xl font-black mb-2 flex items-center gap-2">
                                                {isCorrect ? <Icon.Check /> : <span>âŒ å†æ¥å†å²</span>}
                                                {isCorrect ? 'ç­”å°äº†ï¼' : 'å“å‘€ï¼Œå°å¿ƒä¸€é»ï¼'}
                                            </h3>
                                            <p className="font-bold text-lg leading-relaxed opacity-90">{currentQ.explanation}</p>
                                        </div>
                                        <button onClick={nextQ} className="w-full bg-indigo-600 text-white font-black py-4 rounded-xl text-lg shadow-xl shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-all flex items-center justify-center gap-2">
                                            {qIndex < TOTAL_QUESTIONS - 1 ? 'ä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹æˆç¸¾'} <Icon.ArrowRight />
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (step === 'result') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-[2.5rem] shadow-2xl p-10 text-center border border-slate-100">
                            <h2 className="text-4xl font-black text-slate-800 mb-2">è€ƒè©¦çµæŸ</h2>
                            <p className="text-slate-400 font-bold uppercase tracking-widest mb-8">Jasper çš„æˆç¸¾å–®</p>
                            
                            <div className="relative w-40 h-40 mx-auto mb-8 flex items-center justify-center">
                                <svg className="absolute inset-0 w-full h-full" viewBox="0 0 36 36">
                                    <path className="text-slate-100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="3" />
                                    <path className="text-indigo-600" strokeDasharray={`${(score/TOTAL_QUESTIONS)*100}, 100`} d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="3" />
                                </svg>
                                <span className="text-5xl font-black text-slate-800">{Math.round((score/TOTAL_QUESTIONS)*100)}<span className="text-2xl">%</span></span>
                            </div>

                            <p className="text-lg font-bold text-slate-600 mb-8">
                                {score === TOTAL_QUESTIONS ? 'å¤ªæ£’äº†ï¼å…¨å°ï¼ğŸ‰' : 
                                 score > TOTAL_QUESTIONS/2 ? 'åšå¾—ä¸éŒ¯ï¼Œä½†è¦è¨˜å¾—å¯«ç›´å¼æª¢æŸ¥å–”ï¼' : 
                                 'ä¸è¦ç°å¿ƒï¼Œå¤šç·´ç¿’ç›´å¼è¨ˆç®—å°±æœƒé€²æ­¥ï¼'}
                            </p>

                            <button onClick={startQuiz} className="w-full bg-slate-900 text-white font-black py-4 rounded-xl shadow-lg transition-all active:scale-95">
                                å†åšä¸€æ¬¡
                            </button>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
